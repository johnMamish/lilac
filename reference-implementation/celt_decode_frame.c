/**
 * Decodes a single CELT frame and dumps human-readable information about it to stdout.
 */

#include <assert.h>
#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>

#include "range_coder.h"
#include "symbol_context.h"

#define ARRAY_NUMEL(arr) (sizeof(arr) / (sizeof(arr[0])))


const symbol_context_t* symbols_to_decode[] = {
    &CELT_silence_context,
    &CELT_post_filter_context,
    &CELT_transient_context,
    &CELT_intra_context,
};

uint8_t frame[] =
{
    0x5f, 0x48, 0x95, 0x5a, 0x27, 0x38, 0x72,
    0x17, 0xe0, 0xc2, 0x34, 0x30, 0x13, 0x37, 0x82,
    0x63, 0x2d, 0xc4, 0x26, 0x75, 0xce, 0xb3, 0x4d,
    0x72, 0x02, 0x31, 0xe9, 0x93, 0x94, 0xa7, 0xe5,
    0x84, 0x33, 0x8c, 0x18, 0xe7, 0xa5, 0xae, 0xcd,
    0x1d, 0x45, 0x77, 0xb4, 0x39, 0xfb, 0x0f, 0xd2,
    0x79, 0x03, 0x4a, 0xf0, 0x43, 0x1a, 0x25, 0xe7,
    0x07, 0xd6, 0x96, 0x4c, 0x42, 0xc8, 0xaf, 0xec,
    0xed, 0x9b, 0x72, 0x0e, 0x22, 0xa8, 0x96, 0xc8,
    0x76, 0xd9, 0xf1, 0x4f, 0xb2, 0x4c, 0x42, 0xae
};

int main(int argc, char** argv)
{
    range_decoder_t* range_decoder = range_decoder_create(frame, sizeof(frame));

    for (int i = 0; i < ARRAY_NUMEL(symbols_to_decode); i++) {
        uint32_t s = range_decoder_decode_symbol(range_decoder, symbols_to_decode[i]);

        printf("Decoded symbol: %i\n\n", s);
    }

    range_decoder_destroy(range_decoder);

    return 0;
}
